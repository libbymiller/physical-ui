#!/usr/bin/env node

var StatusControl = require('../lib/status-control'),
    MagicDial = require('../lib/magic-dial'),
    Button = require('../lib/button');

var statusControl,
    magicDial;

statusControl = new StatusControl([12, 13, 14], 7, [8, 9]);
magicDial = new MagicDial([6, 10, 11], 3, [4, 5]);

var nextButton = new Button(2, { pull: 'up' });
nextButton.on('changed', function () {
  if (statusControl.isOn && nextButton.isPressed()) {
    console.log('Next station');
  }
});

// Keep alive
require('timers').setInterval(function () {}, 10000000);

function cleanup() {
  console.log('Cleaning up before shutdown');
  if (statusControl) { statusControl.destroy(); }
  if (magicDial) { magicDial.destroy(); }

  process.exit();
}

process.on('SIGINT', cleanup);
process.on('uncaughtException', cleanup);
