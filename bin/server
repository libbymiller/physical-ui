#!/usr/bin/env node

var path       = require('path'),
    bootstrap  = require('../lib/bootstrap'),
    opts       = {},
    configPath,
    config;

if(process.argv.length != 3) {
  console.log('Usage: ' + __filename + ' <path to config file>');
  process.exit(1);
}

configPath = path.resolve(__dirname+'/..', process.argv[2]);

try {
  config = require(configPath);
} catch(err) {
  console.warn('Could not parse config at ', configPath, err);
}

console.log('process.env.WIRING_PI', process.env.WIRING_PI);

// Override wiring-pi with mock object
if( process.env.WIRING_PI && process.env.WIRING_PI === 'mock' ) {
  opts.wpi = require('../lib/wiring-pi-mock').create();
}

bootstrap.start(config, opts);
